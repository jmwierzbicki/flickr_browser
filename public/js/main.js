"use strict";function PhotoBrowserController(e,t,a){var n=this;n.search="",n.searchResult={},n.searchResultCached={},n.favList=[];var o=JSON.parse(localStorage.getItem("favList"));o instanceof Array&&(n.favList=o);var r={api_key:"d680468aa8d1d075113d8dbb102c5e6e",method:"flickr.photos.search",text:"",page:1,per_page:50,format:"json",nojsoncallback:1},s=function(e,t){var a="";return r.page=e,r.text=t,Object.keys(r).sort().forEach(function(e,t){a+=e+r[e]}),a},i=function(e,t){var a="https://api.flickr.com/services/rest/?";return r.page=e,r.text=t,Object.keys(r).sort().forEach(function(e,t){a+=e+"="+r[e]+"&"}),a},c=function(e,n){return a(function(a,o){t({method:"GET",url:"http://www.jmwierzbicki.hekko24.pl/getsignature/index.php?string="+s(e,n)}).then(function(e){a(e.data)},function(e){console.log(e)})})};n.searchPhotos=function(e,a){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];c(e,a).then(function(r){t({method:"GET",url:i(e,a)+"api_sig="+r}).then(function(t){console.log(t.data),o?n.searchResultCached=t.data.photos:(n.searchResult=t.data.photos,t.data.photos.page<t.data.photos.pages&&n.searchPhotos(e+1,a,!0))},function(e){console.log(e)})})},n.changePage=function(e){n.searchPhotos(e,n.search)},n.addToFav=function(e){console.log(e);for(var t=!1,a=0;a<n.favList.length;a++)if(n.favList[a].id==e.id){t=!0,alert("Ten obrazek jest już w ulubionych!!");break}t||(n.favList.push(e),localStorage.setItem("favList",JSON.stringify(n.favList)))},n.removeFromFav=function(e){n.favList.splice(e,1),localStorage.setItem("favList",JSON.stringify(n.favList))}}function FavListController(e){var t=this;t.removeFav=function(e){t.onRemove({index:e})}}function SearchListController(e,t){var a=this;a.getColumns=function(){return t.innerWidth>1200?[0,1,2,3]:t.innerWidth>1e3?[0,1,2,3]:t.innerWidth>800?[0,1,2]:t.innerWidth>400?[0,1]:t.innerWidth>1?[0]:void 0},a.apply=function(){console.log("test")},a.getSearchDivided=function(e,t){if(!a.searchResult.photo)return[];var n=[];return a.searchResult.photo.forEach(function(a,o){o%t==e&&n.push(a)}),n},a.searchResult={},a.changePage=function(e){a.onPage({page:e})},a.addFav=function(e){a.onAdd({image:e})},a.getImageThumbUrl=function(e){console.log(e)}}PhotoBrowserController.$inject=["$scope","$http","$q"],FavListController.$inject=["$scope"],SearchListController.$inject=["$scope","$window"];var myApp=angular.module("myApp",["templates"]);angular.module("templates",[]),myApp.component("photoBrowser",{templateUrl:"photoBrowser/photoBrowser.html",controller:PhotoBrowserController,bindings:{}}),myApp.component("favList",{templateUrl:"photoBrowser/favList/favList.html",controller:FavListController,bindings:{favList:"<",onRemove:"&"}}),myApp.component("searchList",{templateUrl:"photoBrowser/searchList/searchList.html",controller:SearchListController,bindings:{searchResult:"<",searchResultCached:"<",onAdd:"&",onPage:"&"}}),myApp.directive("watchResize",["$window",function(e){var t=function(t,a,n){t.width=e.innerWidth,angular.element(e).bind("resize",function(){t.width=e.innerWidth,t.$digest()})};return{link:t,restrict:"A"}}]),angular.module("templates").run(["$templateCache",function(e){e.put("photoBrowser/photoBrowser.html",'<div>\n    <input class="form-control" placeholder="type text to search..." ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}" ng-model="$ctrl.search" ng-change="$ctrl.searchPhotos(1, $ctrl.search)">\n    <div class="row" style="padding-top:20px;">\n        <div class="col-xs-2"><fav-list fav-list="$ctrl.favList" on-remove="$ctrl.removeFromFav(index)"></fav-list></div>\n        <div class="col-xs-9"><search-list watch-resize search-result="$ctrl.searchResult" search-result-cached="$ctrl.searchResultCached" on-add="$ctrl.addToFav(image)" on-page="$ctrl.changePage(page)"></search-list></div>\n    </div>\n</div>\n'),e.put("photoBrowser/favList/favList.html",'<div>\n    ulubione:\n</div>\n<div style="position:relative;" ng-repeat="image in $ctrl.favList track by $index">\n    <a data-toggle="modal" data-target="#myModal{{$index}}">\n        <img style="width: 100%;"  ng-src="https://farm{{image.farm}}.staticflickr.com/{{image.server}}/{{image.id}}_{{image.secret}}_m.jpg">\n    </a>    <span class="glyphicon glyphicon-remove remove-button" ng-click="$ctrl.removeFav($index)"> </span>\n\n    <!-- Modal -->\n    <div class="modal fade" id="myModal{{$index}}" role="dialog">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal">&times;</button>\n\n                </div>\n                <div class="modal-body" style="text-align: center;">\n                    id:{{image.id}}<br>\n                    title:{{image.title}}<br>\n                    <img style="max-width: 100%;"  ng-src="https://farm{{image.farm}}.staticflickr.com/{{image.server}}/{{image.id}}_{{image.secret}}_c.jpg">\n                </div>\n\n            </div>\n        </div>\n    </div>\n\n\n\n</div>\n'),e.put("photoBrowser/searchList/searchList.html",'<span ng-show="$ctrl.searchResult.total >= 0">liczba znalezionych obrazków:</span> {{$ctrl.searchResult.total}}\n<br>\n<div style="text-align: center;" ng-show="$ctrl.searchResult.pages > 1">\n    <span ng-show="$ctrl.searchResult.page > 1" class="glyphicon glyphicon-menu-left" ng-click="$ctrl.changePage($ctrl.searchResult.page-1)"> </span>\n    page: {{$ctrl.searchResult.page}}\n    <span  ng-show="$ctrl.searchResult.page < $ctrl.searchResult.pages" class="glyphicon glyphicon-menu-right" ng-click="$ctrl.changePage($ctrl.searchResult.page+1)"> </span>\n</div>\n\n\n    <section class="row">\n        <div  ng-repeat="column in $ctrl.getColumns()" class="col-xs-{{12 / $ctrl.getColumns().length}} img-column">\n            <img style="width:100%;" ng-repeat="image in $ctrl.getSearchDivided(column, $ctrl.getColumns().length)" ng-click="$ctrl.addFav(image)" src="images/Placeholder.png" ng-src="https://farm{{image.farm}}.staticflickr.com/{{image.server}}/{{image.id}}_{{image.secret}}_m.jpg" >\n\n        </div>\n    </section>\n\n<div ng-repeat="image in $ctrl.searchResultCached.photo" style="background-image:url(\'https://farm{{image.farm}}.staticflickr.com/{{image.server}}/{{image.id}}_{{image.secret}}_m.jpg\')"></div>\n\n')}]);